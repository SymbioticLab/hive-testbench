(TOK_EXPLAIN (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_LEFTOUTERJOIN (TOK_TABREF (TOK_TABNAME store_sales)) (TOK_TABREF (TOK_TABNAME store_returns)) (and (= (. (TOK_TABLE_OR_COL store_returns) sr_item_sk) (. (TOK_TABLE_OR_COL store_sales) ss_item_sk)) (= (. (TOK_TABLE_OR_COL store_returns) sr_ticket_number) (. (TOK_TABLE_OR_COL store_sales) ss_ticket_number)))) (TOK_TABREF (TOK_TABNAME reason)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL ss_item_sk)) (TOK_SELEXPR (TOK_TABLE_OR_COL ss_ticket_number)) (TOK_SELEXPR (TOK_TABLE_OR_COL ss_customer_sk)) (TOK_SELEXPR (TOK_FUNCTION when (TOK_FUNCTION TOK_ISNOTNULL (TOK_TABLE_OR_COL sr_return_quantity)) (* (- (TOK_TABLE_OR_COL ss_quantity) (TOK_TABLE_OR_COL sr_return_quantity)) (TOK_TABLE_OR_COL ss_sales_price)) (* (TOK_TABLE_OR_COL ss_quantity) (TOK_TABLE_OR_COL ss_sales_price))) act_sales)) (TOK_WHERE (and (= (. (TOK_TABLE_OR_COL store_returns) sr_reason_sk) (. (TOK_TABLE_OR_COL reason) r_reason_sk)) (= (TOK_TABLE_OR_COL r_reason_desc) 'Did not like the warranty'))))) t)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL ss_customer_sk)) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL act_sales)) sumsales)) (TOK_GROUPBY (TOK_TABLE_OR_COL ss_customer_sk)) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL sumsales)) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL ss_customer_sk))) (TOK_LIMIT 100))) FORMATTED)