(TOK_EXPLAIN (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_JOIN (TOK_TABREF (TOK_TABNAME store_sales) ss) (TOK_TABREF (TOK_TABNAME date_dim) d1) (= (. (TOK_TABLE_OR_COL d1) d_date_sk) (. (TOK_TABLE_OR_COL ss) ss_sold_date_sk))) (TOK_TABREF (TOK_TABNAME store) s) (= (. (TOK_TABLE_OR_COL s) s_store_sk) (. (TOK_TABLE_OR_COL ss) ss_store_sk)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL ss_net_profit)) total_sum) (TOK_SELEXPR (TOK_TABLE_OR_COL s_state)) (TOK_SELEXPR (TOK_TABLE_OR_COL s_county)) (TOK_SELEXPR (TOK_TABLE_OR_COL grouping__id) lochierarchy) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_DISTRIBUTEBY (TOK_TABLE_OR_COL grouping__id) (TOK_FUNCTION when (== (TOK_TABLE_OR_COL grouping__id) 2) (TOK_TABLE_OR_COL s_state))) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_FUNCTION sum (TOK_TABLE_OR_COL ss_net_profit))))))) rank_within_parent)) (TOK_WHERE (and (TOK_FUNCTION between KW_FALSE (. (TOK_TABLE_OR_COL d1) d_month_seq) 1193 (+ 1193 11)) (TOK_SUBQUERY_EXPR (TOK_SUBQUERY_OP in) (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_JOIN (TOK_TABREF (TOK_TABNAME store_sales)) (TOK_TABREF (TOK_TABNAME store))) (TOK_TABREF (TOK_TABNAME date_dim)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL s_state) s_state) (TOK_SELEXPR (TOK_FUNCTION sum (TOK_TABLE_OR_COL ss_net_profit))) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_DISTRIBUTEBY (TOK_TABLE_OR_COL s_state)) (TOK_ORDERBY (TOK_TABSORTCOLNAMEDESC (TOK_FUNCTION sum (TOK_TABLE_OR_COL ss_net_profit))))))) ranking)) (TOK_WHERE (and (and (TOK_FUNCTION between KW_FALSE (TOK_TABLE_OR_COL d_month_seq) 1193 (+ 1193 11)) (= (. (TOK_TABLE_OR_COL date_dim) d_date_sk) (. (TOK_TABLE_OR_COL store_sales) ss_sold_date_sk))) (= (. (TOK_TABLE_OR_COL store) s_store_sk) (. (TOK_TABLE_OR_COL store_sales) ss_store_sk)))) (TOK_GROUPBY (TOK_TABLE_OR_COL s_state)))) tmp1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL s_state))) (TOK_WHERE (<= (TOK_TABLE_OR_COL ranking) 5)))) (. (TOK_TABLE_OR_COL s) s_state)))) (TOK_ROLLUP_GROUPBY (TOK_TABLE_OR_COL s_state) (TOK_TABLE_OR_COL s_county)) (TOK_ORDERBY (TOK_TABSORTCOLNAMEDESC (TOK_TABLE_OR_COL lochierarchy)) (TOK_TABSORTCOLNAMEASC (TOK_FUNCTION when (= (TOK_TABLE_OR_COL lochierarchy) 0) (TOK_TABLE_OR_COL s_state))) (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL rank_within_parent))) (TOK_LIMIT 100))) FORMATTED)