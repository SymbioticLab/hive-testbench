(TOK_EXPLAIN (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_JOIN (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_TABREF (TOK_TABNAME catalog_sales) cs) (TOK_TABREF (TOK_TABNAME date_dim) d) (= (. (TOK_TABLE_OR_COL d) d_date_sk) (. (TOK_TABLE_OR_COL cs) cs_sold_date_sk)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL cs) cs_item_sk) cs_item_sk) (TOK_SELEXPR (. (TOK_TABLE_OR_COL cs) cs_ext_discount_amt) cs_ext_discount_amt)) (TOK_WHERE (TOK_FUNCTION between KW_FALSE (. (TOK_TABLE_OR_COL d) d_date) '2000-01-27' '2000-04-27')))) cs1) (TOK_TABREF (TOK_TABNAME item) i) (= (. (TOK_TABLE_OR_COL i) i_item_sk) (. (TOK_TABLE_OR_COL cs1) cs_item_sk))) (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_TABREF (TOK_TABNAME catalog_sales) cs) (TOK_TABREF (TOK_TABNAME date_dim) d) (= (. (TOK_TABLE_OR_COL d) d_date_sk) (. (TOK_TABLE_OR_COL cs) cs_sold_date_sk)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL cs) cs_item_sk) cs_item_sk) (TOK_SELEXPR (. (TOK_TABLE_OR_COL cs) cs_ext_discount_amt) cs_ext_discount_amt)) (TOK_WHERE (TOK_FUNCTION between KW_FALSE (. (TOK_TABLE_OR_COL d) d_date) '2000-01-27' '2000-04-27')))) cs2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL cs2) cs_item_sk) cs_item_sk) (TOK_SELEXPR (* 1.3 (TOK_FUNCTION avg (TOK_TABLE_OR_COL cs_ext_discount_amt))) avg_cs_ext_discount_amt)) (TOK_GROUPBY (. (TOK_TABLE_OR_COL cs2) cs_item_sk)))) tmp1) (= (. (TOK_TABLE_OR_COL i) i_item_sk) (. (TOK_TABLE_OR_COL tmp1) cs_item_sk)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_FUNCTION sum (. (TOK_TABLE_OR_COL cs1) cs_ext_discount_amt)) excess_discount_amount)) (TOK_WHERE (and (= (. (TOK_TABLE_OR_COL i) i_manufact_id) 436) (> (. (TOK_TABLE_OR_COL cs1) cs_ext_discount_amt) (. (TOK_TABLE_OR_COL tmp1) avg_cs_ext_discount_amt)))))) FORMATTED)