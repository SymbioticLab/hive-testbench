(TOK_EXPLAIN (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNIONALL (TOK_UNIONALL (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_LEFTOUTERJOIN (TOK_TABREF (TOK_TABNAME web_sales) ws) (TOK_TABREF (TOK_TABNAME web_returns) wr) (and (= (. (TOK_TABLE_OR_COL ws) ws_order_number) (. (TOK_TABLE_OR_COL wr) wr_order_number)) (= (. (TOK_TABLE_OR_COL ws) ws_item_sk) (. (TOK_TABLE_OR_COL wr) wr_item_sk)))) (TOK_TABREF (TOK_TABNAME date_dim)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL ws) ws_item_sk) item) (TOK_SELEXPR (/ (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL wr) wr_return_quantity) 0))) (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL ws) ws_quantity) 0)))) return_ratio) (TOK_SELEXPR (/ (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL wr) wr_return_amt) 0))) (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL ws) ws_net_paid) 0)))) currency_ratio)) (TOK_WHERE (and (and (and (and (and (and (> (. (TOK_TABLE_OR_COL wr) wr_return_amt) 10000) (> (. (TOK_TABLE_OR_COL ws) ws_net_profit) 1)) (> (. (TOK_TABLE_OR_COL ws) ws_net_paid) 0)) (> (. (TOK_TABLE_OR_COL ws) ws_quantity) 0)) (= (. (TOK_TABLE_OR_COL ws) ws_sold_date_sk) (. (TOK_TABLE_OR_COL date_dim) d_date_sk))) (= (TOK_TABLE_OR_COL d_year) 2000)) (= (TOK_TABLE_OR_COL d_moy) 12))) (TOK_GROUPBY (. (TOK_TABLE_OR_COL ws) ws_item_sk)))) in_web)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL item)) (TOK_SELEXPR (TOK_TABLE_OR_COL return_ratio)) (TOK_SELEXPR (TOK_TABLE_OR_COL currency_ratio)) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL return_ratio)))))) return_rank) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL currency_ratio)))))) currency_rank)))) web)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'web' channel) (TOK_SELEXPR (. (TOK_TABLE_OR_COL web) item)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL web) return_ratio)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL web) return_rank)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL web) currency_rank))) (TOK_WHERE (or (<= (. (TOK_TABLE_OR_COL web) return_rank) 10) (<= (. (TOK_TABLE_OR_COL web) currency_rank) 10))))) (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_LEFTOUTERJOIN (TOK_TABREF (TOK_TABNAME catalog_sales) cs) (TOK_TABREF (TOK_TABNAME catalog_returns) cr) (and (= (. (TOK_TABLE_OR_COL cs) cs_order_number) (. (TOK_TABLE_OR_COL cr) cr_order_number)) (= (. (TOK_TABLE_OR_COL cs) cs_item_sk) (. (TOK_TABLE_OR_COL cr) cr_item_sk)))) (TOK_TABREF (TOK_TABNAME date_dim)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL cs) cs_item_sk) item) (TOK_SELEXPR (/ (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL cr) cr_return_quantity) 0))) (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL cs) cs_quantity) 0)))) return_ratio) (TOK_SELEXPR (/ (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL cr) cr_return_amount) 0))) (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL cs) cs_net_paid) 0)))) currency_ratio)) (TOK_WHERE (and (and (and (and (and (and (> (. (TOK_TABLE_OR_COL cr) cr_return_amount) 10000) (> (. (TOK_TABLE_OR_COL cs) cs_net_profit) 1)) (> (. (TOK_TABLE_OR_COL cs) cs_net_paid) 0)) (> (. (TOK_TABLE_OR_COL cs) cs_quantity) 0)) (= (TOK_TABLE_OR_COL cs_sold_date_sk) (TOK_TABLE_OR_COL d_date_sk))) (= (TOK_TABLE_OR_COL d_year) 2000)) (= (TOK_TABLE_OR_COL d_moy) 12))) (TOK_GROUPBY (. (TOK_TABLE_OR_COL cs) cs_item_sk)))) in_cat)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL item)) (TOK_SELEXPR (TOK_TABLE_OR_COL return_ratio)) (TOK_SELEXPR (TOK_TABLE_OR_COL currency_ratio)) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL return_ratio)))))) return_rank) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL currency_ratio)))))) currency_rank)))) catalog)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'catalog' channel) (TOK_SELEXPR (. (TOK_TABLE_OR_COL catalog) item)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL catalog) return_ratio)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL catalog) return_rank)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL catalog) currency_rank))) (TOK_WHERE (or (<= (. (TOK_TABLE_OR_COL catalog) return_rank) 10) (<= (. (TOK_TABLE_OR_COL catalog) currency_rank) 10)))))) (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_QUERY (TOK_FROM (TOK_JOIN (TOK_LEFTOUTERJOIN (TOK_TABREF (TOK_TABNAME store_sales) sts) (TOK_TABREF (TOK_TABNAME store_returns) sr) (and (= (. (TOK_TABLE_OR_COL sts) ss_ticket_number) (. (TOK_TABLE_OR_COL sr) sr_ticket_number)) (= (. (TOK_TABLE_OR_COL sts) ss_item_sk) (. (TOK_TABLE_OR_COL sr) sr_item_sk)))) (TOK_TABREF (TOK_TABNAME date_dim)))) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL sts) ss_item_sk) item) (TOK_SELEXPR (/ (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL sr) sr_return_quantity) 0))) (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL sts) ss_quantity) 0)))) return_ratio) (TOK_SELEXPR (/ (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL sr) sr_return_amt) 0))) (TOK_FUNCTION (TOK_DECIMAL 15 4) (TOK_FUNCTION sum (TOK_FUNCTION coalesce (. (TOK_TABLE_OR_COL sts) ss_net_paid) 0)))) currency_ratio)) (TOK_WHERE (and (and (and (and (and (and (> (. (TOK_TABLE_OR_COL sr) sr_return_amt) 10000) (> (. (TOK_TABLE_OR_COL sts) ss_net_profit) 1)) (> (. (TOK_TABLE_OR_COL sts) ss_net_paid) 0)) (> (. (TOK_TABLE_OR_COL sts) ss_quantity) 0)) (= (TOK_TABLE_OR_COL ss_sold_date_sk) (TOK_TABLE_OR_COL d_date_sk))) (= (TOK_TABLE_OR_COL d_year) 2000)) (= (TOK_TABLE_OR_COL d_moy) 12))) (TOK_GROUPBY (. (TOK_TABLE_OR_COL sts) ss_item_sk)))) in_store)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR (TOK_TABLE_OR_COL item)) (TOK_SELEXPR (TOK_TABLE_OR_COL return_ratio)) (TOK_SELEXPR (TOK_TABLE_OR_COL currency_ratio)) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL return_ratio)))))) return_rank) (TOK_SELEXPR (TOK_FUNCTION rank (TOK_WINDOWSPEC (TOK_PARTITIONINGSPEC (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC (TOK_TABLE_OR_COL currency_ratio)))))) currency_rank)))) store)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'store' channel) (TOK_SELEXPR (. (TOK_TABLE_OR_COL store) item)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL store) return_ratio)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL store) return_rank)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL store) currency_rank))) (TOK_WHERE (or (<= (. (TOK_TABLE_OR_COL store) return_rank) 10) (<= (. (TOK_TABLE_OR_COL store) currency_rank) 10)))))) _u1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR TOK_ALLCOLREF)) (TOK_ORDERBY (TOK_TABSORTCOLNAMEASC 1) (TOK_TABSORTCOLNAMEASC 4) (TOK_TABSORTCOLNAMEASC 5)) (TOK_LIMIT 100))) FORMATTED)